from langchain_google_genai import ChatGoogleGenerativeAI
from langchain.prompts import PromptTemplate
from langchain.chains import LLMChain
import os

os.environ["GOOGLE_API_KEY"] = "AIzaSyAZSP3AXxW8vmcalgAYmikudzSqT_IgWQk"
llm = ChatGoogleGenerativeAI(model="gemini-pro")


def extract_symptom(text):

    title_template = PromptTemplate(
            input_variables=['conversation'],
            template="""i want you to be an disease symptom analyzer and analyze the below said conversation between doctor and patient and list the symptoms that the patient have and return them in python list format
            {conversation}"""
        )

    title_chain = LLMChain(llm=llm, prompt=title_template, verbose=False, output_key='output')

    response = title_chain.invoke({'conversation': text})
    print(response)
    
    return response["output"]

convo =""" Yeah. So you're a 26 year old, generally healthy and with sorry, back pain? Chest pain. Chest pain. Okay. When did the chest pain start? So I I guess I I don't know if I'd really call it pain. It's it's been just very uncomfortable. Like, it just felt a little odd for, like, a week and a half. Week and a half? It's kind of yeah. It's kind of, like, a very sharp strong pain, when I take a deep breath. Okay. But I don't notice it all the time. It's just it's often when I'm sitting and studying or, when I'm walking when I'm walking to school. Okay. Did you have any accidents or injuries around that time? No. Nothing that I can think of. Okay. Did it come on suddenly, or is it more gradual? Yeah. It's, no. It's it's pretty it's pretty well. It seems the same each time. It's kind of last, like, 20 minutes or so. And I've tried Tylenol, and I've tried Advil, and I've even tried, like, like, an Alka Seltzer, and it hasn't really helped very much. Okay. So it's pretty cons it's not consistent throughout the day. It only happens at certain times of the day? Yeah. It'll come on for, like, 20 minutes, like, here and there. Okay. Anything that you think triggers it? I don't I don't really know. I I was kind of worried. I I was kinda worried that it could be a heart thing. I I feel like it might it might be it it could be stress, but I'm I'm not really sure. And my dad had a a heart attack last year. He was pretty young. He's, like, in his fifties, and it it just kind of scares me because now he's having these heart problems. Okay. So these chest pains last for about 20 minutes. It only happens when you take a deep breath in. And after the 20 minutes, do they come and go? Is it something that gradually weans off, or is it fairly sharp? It seems like it kind of goes away once I once I'm at school and, like, talking to people and doing other things. It's kind of when I notice it when I'm on my walks, when I'm alone, or, like, when I'm studying alone more. Like, maybe I have it when I'm talking to other people, but I don't really notice it. Okay. Does it get worse with exercise? I don't think so. It just kinda like, when I'm walking to school, it kinda stays the same. I haven't done any strenuous exercise lately because I've just had so much, schoolwork piling up. So you mainly get it at so you can get it at rest, I should say. Exactly. Yeah. Like, when I'm studying. Okay. Any fevers, sick at all last little while? No. No. I don't think so. No? You've been feeling well otherwise? Yeah. Other I mean, besides just kind of feeling stressed, I, like, I I've been trying to quit smoking, and that's been that's been kind of hard. And school's just very, very, busy right now. When did you stop smoking? So, like, I guess I'm trying to quit. I'm smoking less than I used to. I probably smoke 5 cigarettes a day, but it used to be a little bit more. Okay. Coming back to the stress, is there anything recently that's causing you more worries? It's just that I'm I'm doing my master's of social work, and I'm getting towards the end. And it's just it's very scary because I'm working on my final, thesis, and there's just a lot involved. And it's it's just making me very nervous. Okay. Is there anything special about the last couple of weeks that's maybe more stressed than previously? I think just the the time crunch of having to to finish this. I've I've never felt, like, so, like, there is so little time to to do the work that I need to do. Got it. And have you ever felt this pain before? Anytime in your life? No. Not before this. Okay. So it comes on several times a day, not necessarily triggered by anything. You said you smoke. When did you start smoking? Like, when I was probably 18. I I sometimes smoked a little, and then I smoked a little more, maybe, like, 10 cigarettes a day for, like, the last 2 years, but then a few months ago, I've been I've been cutting it in half. Okay. Now when you get this chest this chest pain, do you ever feel short of breath? I I I think I I make myself nervous with it, and then I kind of start breathing faster, but I don't have a hard I don't have a hard time breathing otherwise. And it's hard to get a deep breath because I'm it makes me really nervous. Does your heart ever flutter? Feel like it's skipping a beat? No. Only if I only if I, like, if I if I'm having kind of an anxiety attack that felt like that before, but not any other time. Okay. Don't get any chest pain. Alright. And just in terms of other things, so anything else you've seen a doctor for in the past? You mentioned anxiety attacks. Yeah. Like, I talked to my family doctor about that when I was a teenager, but I really, haven't, you know, seen my doctor for it anytime in the last, like, 8 years or so. Anything else you've seen, miss Ann? Oh, sorry. No. Nothing else. I just I that I was kind of when I was in high school, I I had those, and then I really haven't for a long time. But, lately, I felt like this like, I I could maybe get them again. So you've never had asthma as a child? No. And you don't have asthma now? No. Okay. Do you take any medications right now? No. Like, I take, like, a multivitamin, but that's it. Okay. And you live in London? Mhmm. And do, like, for school. Got it. You lived during your master's in social work. Have anyone been around you've been sick at all last little while? No. Like, I live alone. I haven't really seen very many people lately. Okay. And how do you manage stress when you do get it? I I try to I try to, like, set some time aside just to read books that, like, I like to read instead of, like, school books at nighttime. And I do really enjoy running. It's I've been a little bit nervous to do it lately, but, usually, I run, like, a few times a week. Okay. And when you're pretty preoccupied, do you ever get the chest pain? Like, when I'm really when I'm work like, working with classmates or, like, thinking really like, if I'm talking to someone else, I don't really get it or if I if I'm, like, working on a task with my hand. But it's when I'm walking and I I'm alone kinda with my thoughts or when I'm studying, that's when I when I get it. Understood. And you said your father passed early from a heart attack. I'm sorry. But any else in your family, either your parents or mom, have any health issues? He's alive. Like, he had a heart attack. He just now he has to see a lot of heart doctors. No. There there's nothing else in my family like that. I I don't really know, like, about my grandpa, like, my dad's dad, but, like, he might have also. He just kind of he just passed away young from, like, an accident. So, yeah, I'm not really sure. Got it. So no one has died suddenly with no explanation when they were young or while they were swimming? No. No one's ever talked about arrhythmias, or is that a word familiar to you? No. No. It's just my dad and his heart attack. That's, like, the only thing I know of. Okay. Sounds good. I think I've got all the information I need, and I'll pass it on to the doctor who'll take a look at you. Okay. Have a good one. Okay. Thank you."""


print(extract_symptom(convo))